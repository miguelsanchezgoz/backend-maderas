<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maderas La Choca - Tabasco | Cotizador Inteligente</title>
    <style>
        :root { --primary: #8B4513; --accent: #D2691E; --light: #F4F1EA; --dark: #2C1810; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--light); color: var(--dark); margin: 0; padding: 0; }
        
        /* Header */
        header { background: var(--dark); color: white; padding: 1rem; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .brand { font-size: 1.5rem; font-weight: bold; letter-spacing: 1px; }
        .cart-icon { float: right; cursor: pointer; position: relative; }
        .cart-count { background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.8rem; position: absolute; top: -5px; right: -5px; }

        /* Grid de Productos */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; border: 1px solid #ddd; }
        .card:hover { transform: translateY(-5px); }
        .card-header { background: var(--primary); color: white; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .card-body { padding: 15px; }
        .desc { font-size: 0.9rem; color: #666; margin-bottom: 15px; height: 40px; }

        /* Controles */
        button.add-btn { background: var(--accent); color: white; border: none; width: 100%; padding: 12px; font-size: 1rem; font-weight: bold; border-radius: 6px; cursor: pointer; margin-top: 10px; transition: background 0.2s; }
        button.add-btn:hover { background: var(--primary); }

        /* Chatbot */
        .chat-btn { position: fixed; bottom: 20px; right: 20px; background: var(--accent); color: white; width: 60px; height: 60px; border-radius: 50%; text-align: center; line-height: 60px; font-size: 30px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 1000; }
        .chat-window { display: none; position: fixed; bottom: 90px; right: 20px; width: 350px; height: 450px; background: white; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1000; flex-direction: column; overflow: hidden; border: 1px solid #ddd; }
        .chat-header { background: var(--dark); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; font-size: 0.9rem; }
        .chat-input-area { padding: 10px; border-top: 1px solid #eee; display: flex; background: white; }
        .chat-input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 20px; outline: none; }
        .send-btn { background: var(--primary); color: white; border: none; padding: 8px 15px; margin-left: 5px; border-radius: 20px; cursor: pointer; }
        .msg { margin-bottom: 10px; padding: 8px 12px; border-radius: 15px; max-width: 80%; word-wrap: break-word; }
        .msg-user { background: #dcf8c6; margin-left: auto; color: #333; }
        .msg-bot { background: white; margin-right: auto; border: 1px solid #eee; }
        .typing { font-style: italic; color: #888; font-size: 0.8rem; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

<header>
    <div class="container" style="padding: 0; display: flex; justify-content: space-between; align-items: center;">
        <div class="brand">MADERAS LA CHOCA <span style="font-size: 0.8rem; font-weight: normal;">| Tabasco</span></div>
        <div class="cart-icon">üõí <span id="cart-count">0</span></div>
    </div>
</header>

<div class="container">
    <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid #2196F3;">
        <strong>üöÄ Conexi√≥n Exitosa:</strong> Cotizador conectado a la API de Digital Core Solutions en Render.
    </div>
    <div class="grid" id="product-grid"></div>
</div>

<div class="chat-btn" onclick="toggleChatWindow()">ü§ñ</div>

<div class="chat-window" id="chatWindow">
    <div class="chat-header"><span>Asistente Maderas La Choca</span><span style="cursor:pointer;" onclick="toggleChatWindow()">‚úñ</span></div>
    <div class="chat-body" id="chatBody">
        <div class="msg msg-bot">¬°Hola! Soy tu asistente de cotizaci√≥n. Puedes preguntarme precios por Pie Tablar o pedirme que convierta tus medidas de cent√≠metros a pulgadas.</div>
        <div class="typing" id="typingIndicator">Procesando respuesta...</div>
    </div>
    <div class="chat-input-area">
        <input type="text" id="chatInput" class="chat-input" placeholder="Pregunta algo..." onkeypress="handleEnter(event)">
        <button class="send-btn" onclick="sendMessage()">‚û§</button>
    </div>
</div>

<script>
    const maderas = [
        { id: 1, nombre: "Cedro Rojo", precioPT: 85, desc: "Madera preciosa y arom√°tica." },
        { id: 2, nombre: "Macuil√≠s", precioPT: 45, desc: "Ideal para ebanister√≠a fina." },
        { id: 3, nombre: "Pino Estufado", precioPT: 28, desc: "Resistente para construcci√≥n." },
        { id: 4, nombre: "Tinto", precioPT: 120, desc: "Extremadamente dura y pesada." },
        { id: 5, nombre: "Caoba", precioPT: 95, desc: "Acabado de lujo superior." }
    ];

    const grid = document.getElementById('product-grid');
    maderas.forEach(madera => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div class="card-header"><span>${madera.nombre}</span><span>$${madera.precioPT} / PT</span></div>
            <div class="card-body">
                <div class="desc">${madera.desc}</div>
                <button class="add-btn" onclick="alert('Carrito en desarrollo')">Agregar al Pedido</button>
            </div>`;
        grid.appendChild(card);
    });

    function toggleChatWindow() {
        const chat = document.getElementById('chatWindow');
        chat.style.display = (chat.style.display === 'flex') ? 'none' : 'flex';
    }

    function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }

    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const text = input.value.trim();
        if (!text) return;

        addMessage(text, 'user');
        input.value = '';
        
        const typing = document.getElementById('typingIndicator');
        typing.style.display = 'block';
        chatScroll();

        try {
            // URL DE TU SERVIDOR EN RENDER
            const response = await fetch('https://api-maderas-choca.onrender.com/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mensaje: text })
            });

            const data = await response.json();
            typing.style.display = 'none';
            
            let cleanResponse = data.respuesta.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
            addMessage(cleanResponse, 'bot');

        } catch (error) {
            typing.style.display = 'none';
            addMessage("‚ö†Ô∏è El servidor est√° iniciando. Por favor, espera 30 segundos y vuelve a preguntar.", 'bot');
        }
    }

    function addMessage(text, sender) {
        const body = document.getElementById('chatBody');
        const div = document.createElement('div');
        div.className = `msg msg-${sender}`;
        div.innerHTML = text;
        body.insertBefore(div, document.getElementById('typingIndicator'));
        chatScroll();
    }

    function chatScroll() {
        const body = document.getElementById('chatBody');
        body.scrollTop = body.scrollHeight;
    }
</script>
</body>
</html>